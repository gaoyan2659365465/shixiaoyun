{"version":3,"file":"login.js","sources":["pages/login/login.vue","E:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\r\n\t<view class=\"login-container\">\r\n\t\t<view class=\"title\">积分商城</view>\r\n\t\t\r\n\t\t<view class=\"register-text\">注册新用户</view>\r\n\t\t\r\n\t\t<view class=\"agreement\">\r\n\t\t\t<checkbox :checked=\"agreed\" @tap=\"agreed = !agreed\" color=\"#000\" />\r\n\t\t\t<text>我已阅读并同意《用户协议》《隐私条款》</text>\r\n\t\t</view>\r\n\t\t\r\n\t\t<button class=\"auth-btn\" @tap=\"handleAuth\">一键授权登录</button>\r\n\t\t\r\n\t\t<text class=\"skip-link\" @tap=\"skipLogin\">暂不登录</text>\r\n\t\t\r\n\t\t<view class=\"divider\">\r\n\t\t\t<view class=\"line\"></view>\r\n\t\t\t<text>or</text>\r\n\t\t\t<view class=\"line\"></view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<button class=\"register-btn\" @tap=\"goRegister\">注册新用户</button>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport { userApi } from '@/api/user.js'\r\nimport { storage } from '@/utils/storage.js'\r\n\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tagreed: false\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tasync handleAuth() {\r\n\t\t\tif (!this.agreed) {\r\n\t\t\t\tuni.showToast({ title: '请先同意用户协议和隐私条款', icon: 'none' })\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tuni.showLoading({ title: '登录中...' })\r\n\r\n\t\t\t\t// 获取微信登录凭证\r\n\t\t\t\tconst loginRes = await new Promise((resolve, reject) => {\r\n\t\t\t\t\tuni.login({\r\n\t\t\t\t\t\tprovider: 'weixin',\r\n\t\t\t\t\t\tsuccess: (res) => resolve(res),\r\n\t\t\t\t\t\tfail: (err) => reject(err)\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\r\n\t\t\t\tif (!loginRes.code) {\r\n\t\t\t\t\tthrow new Error('获取微信登录凭证失败')\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 调用后端接口登录\r\n\t\t\t\tconst res = await userApi.loginByWechat({ code: loginRes.code })\r\n\r\n\t\t\t\tif (res.code === 200 && res.data) {\r\n\t\t\t\t\t// 保存token和用户信息\r\n\t\t\t\t\tuni.setStorageSync('token', res.data.token)\r\n\t\t\t\t\tstorage.set('userInfo', res.data.userInfo)\r\n\r\n\t\t\t\t\tuni.showToast({ title: '登录成功', icon: 'success' })\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tuni.switchTab({ url: '/pages/index/index' })\r\n\t\t\t\t\t}, 1500)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(res.message || '登录失败')\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error('授权登录失败:', e)\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: e.message || '登录失败，请重试',\r\n\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\tduration: 2000\r\n\t\t\t\t})\r\n\t\t\t} finally {\r\n\t\t\t\tuni.hideLoading()\r\n\t\t\t}\r\n\t\t},\r\n\t\tskipLogin() {\r\n\t\t\tuni.switchTab({ url: '/pages/index/index' })\r\n\t\t},\r\n\t\tgoRegister() {\r\n\t\t\tuni.navigateTo({ url: '/pages/register/register' })\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.login-container {\r\n\tmin-height: 100vh;\r\n\tbackground-color: #FFFFFF;\r\n\tpadding: 0 40rpx;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\talign-items: center;\r\n}\r\n\r\n.title {\r\n\tfont-size: 48rpx;\r\n\tfont-weight: 600;\r\n\tcolor: #000;\r\n\tmargin-top: 200rpx;\r\n\tmargin-bottom: 120rpx;\r\n}\r\n\r\n.register-text {\r\n\tfont-size: 32rpx;\r\n\tcolor: #000;\r\n\tmargin-bottom: 40rpx;\r\n}\r\n\r\n.agreement {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tfont-size: 24rpx;\r\n\tcolor: #666;\r\n\tmargin-bottom: 60rpx;\r\n}\r\n\r\n.agreement checkbox {\r\n\tmargin-right: 12rpx;\r\n\ttransform: scale(0.8);\r\n}\r\n\r\n.auth-btn {\r\n\twidth: 670rpx;\r\n\theight: 96rpx;\r\n\tbackground-color: #000;\r\n\tcolor: #FFF;\r\n\tfont-size: 32rpx;\r\n\tborder-radius: 48rpx;\r\n\tborder: none;\r\n\tmargin-bottom: 40rpx;\r\n}\r\n\r\n.skip-link {\r\n\tfont-size: 28rpx;\r\n\tcolor: #000;\r\n\tmargin-bottom: 60rpx;\r\n}\r\n\r\n.divider {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\twidth: 670rpx;\r\n\tmargin-bottom: 60rpx;\r\n}\r\n\r\n.divider .line {\r\n\tflex: 1;\r\n\theight: 1rpx;\r\n\tbackground-color: #E5E5E5;\r\n}\r\n\r\n.divider text {\r\n\tfont-size: 24rpx;\r\n\tcolor: #999;\r\n\tmargin: 0 20rpx;\r\n}\r\n\r\n.register-btn {\r\n\twidth: 670rpx;\r\n\theight: 96rpx;\r\n\tbackground-color: #F5F5F5;\r\n\tcolor: #666;\r\n\tfont-size: 32rpx;\r\n\tborder-radius: 48rpx;\r\n\tborder: none;\r\n}\r\n</style>","import MiniProgramPage from 'C:/Users/26593/Documents/HBuilderProjects/shixiaoyun/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","res","userApi","storage"],"mappings":";;;;AA6BA,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,QAAQ;AAAA,IACT;AAAA,EACA;AAAA,EACD,SAAS;AAAA,IACR,MAAM,aAAa;AAClB,UAAI,CAAC,KAAK,QAAQ;AACjBA,sBAAG,MAAC,UAAU,EAAE,OAAO,iBAAiB,MAAM,QAAQ;AACtD;AAAA,MACD;AAEA,UAAI;AACHA,sBAAAA,MAAI,YAAY,EAAE,OAAO,UAAU;AAGnC,cAAM,WAAW,MAAM,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvDA,wBAAAA,MAAI,MAAM;AAAA,YACT,UAAU;AAAA,YACV,SAAS,CAACC,SAAQ,QAAQA,IAAG;AAAA,YAC7B,MAAM,CAAC,QAAQ,OAAO,GAAG;AAAA,WACzB;AAAA,SACD;AAED,YAAI,CAAC,SAAS,MAAM;AACnB,gBAAM,IAAI,MAAM,YAAY;AAAA,QAC7B;AAGA,cAAM,MAAM,MAAMC,iBAAQ,cAAc,EAAE,MAAM,SAAS,MAAM;AAE/D,YAAI,IAAI,SAAS,OAAO,IAAI,MAAM;AAEjCF,wBAAAA,MAAI,eAAe,SAAS,IAAI,KAAK,KAAK;AAC1CG,wBAAAA,QAAQ,IAAI,YAAY,IAAI,KAAK,QAAQ;AAEzCH,wBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,WAAW;AAChD,qBAAW,MAAM;AAChBA,0BAAAA,MAAI,UAAU,EAAE,KAAK,sBAAsB;AAAA,UAC3C,GAAE,IAAI;AAAA,eACD;AACN,gBAAM,IAAI,MAAM,IAAI,WAAW,MAAM;AAAA,QACtC;AAAA,MACD,SAAS,GAAG;AACXA,sBAAAA,MAAc,MAAA,SAAA,+BAAA,WAAW,CAAC;AAC1BA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO,EAAE,WAAW;AAAA,UACpB,MAAM;AAAA,UACN,UAAU;AAAA,SACV;AAAA,MACF,UAAU;AACTA,sBAAAA,MAAI,YAAY;AAAA,MACjB;AAAA,IACA;AAAA,IACD,YAAY;AACXA,oBAAAA,MAAI,UAAU,EAAE,KAAK,sBAAsB;AAAA,IAC3C;AAAA,IACD,aAAa;AACZA,oBAAAA,MAAI,WAAW,EAAE,KAAK,2BAAyB,CAAG;AAAA,IACnD;AAAA,EACD;AACD;;;;;;;;;;;AC1FA,GAAG,WAAW,eAAe;"}
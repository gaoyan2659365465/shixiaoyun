{"version":3,"file":"index.js","sources":["pages/index/index.vue","E:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\r\n\t<view class=\"home-page\">\r\n\t\t<!-- 搜索框 -->\r\n\t\t<SearchBar \r\n\t\t\tplaceholder=\"Search\" \r\n\t\t\t@click=\"handleSearch\" \r\n\t\t/>\r\n\t\t\r\n\t\t<!-- 轮播横幅 -->\r\n\t\t<BannerSwiper \r\n\t\t\tv-if=\"banners.length > 0\"\r\n\t\t\t:banners=\"banners\" \r\n\t\t\t@click=\"handleBannerClick\" \r\n\t\t/>\r\n\t\t\r\n\t\t<!-- 快捷入口 -->\r\n\t\t<QuickEntry \r\n\t\t\tv-if=\"quickEntries.length > 0\"\r\n\t\t\t:entries=\"quickEntries\" \r\n\t\t\t@click=\"handleEntryClick\" \r\n\t\t/>\r\n\t\t\r\n\t\t<!-- 活动列表 -->\r\n\t\t<view class=\"activity-section\">\r\n\t\t\t<SectionTitle \r\n\t\t\t\ttitle=\"活动\" \r\n\t\t\t\tsubtitle=\"再想个名字\"\r\n\t\t\t\t:show-arrow=\"true\"\r\n\t\t\t\t@click=\"handleMoreActivities\"\r\n\t\t\t/>\r\n\t\t\t\r\n\t\t\t<view class=\"activity-list\">\r\n\t\t\t\t<ActivityCard\r\n\t\t\t\t\tv-for=\"activity in activities\"\r\n\t\t\t\t\t:key=\"activity.id\"\r\n\t\t\t\t\t:activity=\"activity\"\r\n\t\t\t\t\t@click-card=\"handleActivityDetail\"\r\n\t\t\t\t\t@click-button=\"handleJoinActivity\"\r\n\t\t\t\t/>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 加载更多 -->\r\n\t\t\t<view v-if=\"hasMore && !loading\" class=\"load-more\" @click=\"loadMoreActivities\">\r\n\t\t\t\t<text class=\"load-more-text\">加载更多</text>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 加载中 -->\r\n\t\t\t<view v-if=\"loading\" class=\"loading\">\r\n\t\t\t\t<uni-load-more status=\"loading\"></uni-load-more>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 没有更多 -->\r\n\t\t\t<view v-else-if=\"!hasMore && activities.length > 0\" class=\"no-more\">\r\n\t\t\t\t<text class=\"no-more-text\">没有更多了</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 空状态 -->\r\n\t\t<view v-if=\"!loading && activities.length === 0\" class=\"empty-state\">\r\n\t\t\t<text class=\"empty-text\">暂无活动</text>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport { getHomeData, getActivities, joinActivity } from '@/api/activity'\r\nimport { homeData } from '@/data/home'\r\nimport SearchBar from './components/SearchBar.vue'\r\nimport BannerSwiper from './components/BannerSwiper.vue'\r\nimport QuickEntry from './components/QuickEntry.vue'\r\nimport SectionTitle from './components/SectionTitle.vue'\r\nimport ActivityCard from './components/ActivityCard.vue'\r\n\r\nexport default {\r\n\tcomponents: {\r\n\t\tSearchBar,\r\n\t\tBannerSwiper,\r\n\t\tQuickEntry,\r\n\t\tSectionTitle,\r\n\t\tActivityCard\r\n\t},\r\n\t\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tbanners: [],\r\n\t\t\tquickEntries: [],\r\n\t\t\tactivities: [],\r\n\t\t\tloading: false,\r\n\t\t\thasMore: true,\r\n\t\t\tpage: 1,\r\n\t\t\tpageSize: 10\r\n\t\t}\r\n\t},\r\n\t\r\n\tonLoad() {\r\n\t\tthis.loadHomeData()\r\n\t},\r\n\t\r\n\tonPullDownRefresh() {\r\n\t\tthis.page = 1\r\n\t\tthis.hasMore = true\r\n\t\tthis.loadHomeData().then(() => {\r\n\t\t\tuni.stopPullDownRefresh()\r\n\t\t})\r\n\t},\r\n\t\r\n\tonReachBottom() {\r\n\t\tif (this.hasMore && !this.loading) {\r\n\t\t\tthis.loadMoreActivities()\r\n\t\t}\r\n\t},\r\n\t\r\n\tmethods: {\r\n\t\t// 加载首页数据\r\n\t\tasync loadHomeData() {\r\n\t\t\ttry {\r\n\t\t\t\tthis.loading = true\r\n\t\t\t\t\r\n\t\t\t\t// 尝试从API获取数据\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst res = await getHomeData()\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\tthis.banners = res.data.banners || []\r\n\t\t\t\t\t\tthis.quickEntries = res.data.quickEntries || []\r\n\t\t\t\t\t\tthis.activities = res.data.activities || []\r\n\t\t\t\t\t\tthis.hasMore = res.data.hasMore || false\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (apiError) {\r\n\t\t\t\t\t// API失败时使用本地数据\r\n\t\t\t\t\tconsole.log('使用本地数据:', apiError)\r\n\t\t\t\t\tthis.banners = homeData.banners\r\n\t\t\t\t\tthis.quickEntries = homeData.quickEntries\r\n\t\t\t\t\tthis.activities = homeData.activities\r\n\t\t\t\t\tthis.hasMore = homeData.hasMore\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('加载首页数据失败:', error)\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '加载失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t} finally {\r\n\t\t\t\tthis.loading = false\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 加载更多活动\r\n\t\tasync loadMoreActivities() {\r\n\t\t\tif (this.loading || !this.hasMore) return\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tthis.loading = true\r\n\t\t\t\tthis.page++\r\n\t\t\t\t\r\n\t\t\t\tconst res = await getActivities({\r\n\t\t\t\t\tpage: this.page,\r\n\t\t\t\t\tpageSize: this.pageSize\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\tthis.activities = [...this.activities, ...res.data.list]\r\n\t\t\t\t\tthis.hasMore = res.data.hasMore\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('加载更多失败:', error)\r\n\t\t\t\tthis.page--\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '加载失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t} finally {\r\n\t\t\t\tthis.loading = false\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 搜索\r\n\t\thandleSearch() {\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl: '/pages/search/search'\r\n\t\t\t})\r\n\t\t},\r\n\t\t\r\n\t\t// 横幅点击\r\n\t\thandleBannerClick({ banner }) {\r\n\t\t\tif (banner.link) {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: banner.link\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 快捷入口点击\r\n\t\thandleEntryClick(entry) {\r\n\t\t\tif (entry.path) {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: entry.path\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 查看更多活动\r\n\t\thandleMoreActivities() {\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl: '/pages/activity/list'\r\n\t\t\t})\r\n\t\t},\r\n\t\t\r\n\t\t// 活动详情\r\n\t\thandleActivityDetail(activity) {\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl: `/pages/activity/detail?id=${activity.id}`\r\n\t\t\t})\r\n\t\t},\r\n\t\t\r\n\t\t// 报名活动\r\n\t\tasync handleJoinActivity(activity) {\r\n\t\t\tif (activity.status === 'ended') {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '活动已结束',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tconst res = await joinActivity(activity.id)\r\n\t\t\t\t\r\n\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '报名成功',\r\n\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// 刷新数据\r\n\t\t\t\t\tthis.loadHomeData()\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: error.message || '报名失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import '@/styles/variables.scss';\r\n\r\n.home-page {\r\n\tmin-height: 100vh;\r\n\tbackground-color: $bg-color;\r\n\tpadding-bottom: 100rpx;\r\n}\r\n\r\n.activity-section {\r\n\tmargin-top: $spacing-4;\r\n}\r\n\r\n.activity-list {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.load-more,\r\n.loading,\r\n.no-more {\r\n\tpadding: $spacing-4;\r\n\ttext-align: center;\r\n}\r\n\r\n.load-more {\r\n\t&:active {\r\n\t\topacity: 0.7;\r\n\t}\r\n}\r\n\r\n.load-more-text {\r\n\tfont-size: $font-t4;\r\n\tcolor: $brand-blue;\r\n\tline-height: $line-height-t4;\r\n}\r\n\r\n.no-more-text {\r\n\tfont-size: $font-t4;\r\n\tcolor: $text-secondary;\r\n\tline-height: $line-height-t4;\r\n}\r\n\r\n.empty-state {\r\n\tpadding: 200rpx $spacing-4;\r\n\ttext-align: center;\r\n}\r\n\r\n.empty-text {\r\n\tfont-size: $font-t4;\r\n\tcolor: $text-secondary;\r\n\tline-height: $line-height-t4;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/26593/Documents/HBuilderProjects/shixiaoyun/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getHomeData","homeData","getActivities","joinActivity"],"mappings":"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"}